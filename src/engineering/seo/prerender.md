# 预渲染

预渲染是一种在构建阶段生成静态 HTML 页面的技术，它将动态内容在构建时预先渲染为静态文件，结合了静态站点的性能优势和动态站点的内容灵活性。

## 什么是预渲染？

预渲染是在应用构建过程中，提前将页面渲染成完整的 HTML 文件，部署后直接作为静态文件服务。

```
渲染时机对比:
客户端渲染:   [请求时] -> [下载JS] -> [浏览器渲染] -> [显示内容]
服务端渲染:   [请求时] -> [服务器渲染] -> [返回HTML] -> [显示内容]
预渲染:       [构建时] -> [预先渲染] -> [部署静态HTML] -> [立即显示]
                     |
                  提前完成渲染工作
```

## 核心工作原理

### 构建时渲染

在项目构建阶段执行渲染逻辑生成静态页面。

```
预渲染流程:
[源代码] -> [构建工具] -> [启动无头浏览器] -> [访问路由] -> [保存HTML]
      |           |              |               |           |
   React/Vue     Webpack       Puppeteer       每个页面     静态文件
      |           |              |               |           |
[部署] -> [静态服务器] -> [用户访问] -> [直接返回HTML] -> [快速展示]
      |           |              |               |           |
   CDN分发      Nginx         请求路径       无需渲染     极速加载
```

### 路由预生成

根据配置的路由列表生成对应的静态页面。

```
路由映射:
[路由配置] -> [路径列表] -> [并行渲染] -> [文件输出]
      |           |           |           |
 /home         /home      生成home.html   dist/home.html
 /about        /about     生成about.html  dist/about.html
 /blog/:id     /blog/1    生成blog/1.html dist/blog/1.html
               /blog/2    生成blog/2.html dist/blog/2.html
```

## 主要优势

### 极致性能

静态文件的加载性能远超动态渲染。

```
性能对比:
指标         客户端渲染   服务端渲染   预渲染
首屏时间:     2-5秒        1-2秒       0.1-0.5秒
服务器负载:    低           高          极低
缓存效果:     一般          中等         极佳
```

### 成本效益

大幅降低服务器资源和运维成本。

```
成本分析:
动态渲染: [服务器集群] -> [持续计算] -> [数据库查询] -> [高成本]
预渲染:   [静态托管] -> [CDN分发] -> [无计算开销] -> [低成本]
              |           |           |           |
           对象存储     全球加速     仅文件服务     经济高效
```

## 技术实现方式

### 构建时预渲染

在项目构建过程中集成预渲染。

```
Webpack配置示例:
// webpack.config.js
const PrerenderSPAPlugin = require('prerender-spa-plugin')

module.exports = {
  plugins: [
    new PrerenderSPAPlugin({
      staticDir: path.join(__dirname, 'dist'),
      routes: ['/', '/about', '/contact']
    })
  ]
}
```

### 命令行工具

使用独立工具进行预渲染。

```
命令行操作:
# 安装预渲染工具
npm install -g prerender

# 执行预渲染
prerender http://localhost:3000 --output dist/

# 结果生成
dist/
  ├── index.html
  ├── about.html
  └── contact.html
```

## 适用场景

### 内容稳定页面

适合内容更新频率较低的页面。

```
理想场景:
[企业官网] -> [产品介绍] -> [帮助文档] -> [博客文章]
      |           |           |           |
   公司信息     规格参数     使用说明     技术文章
      |           |           |           |
  长期稳定     偶尔更新     版本相关     定期发布
```

### 营销落地页

需要极致性能的营销和推广页面。

```
营销页面特点:
[高并发访问] -> [快速加载] -> [SEO友好] -> [转化优化]
      |           |           |           |
  广告流量     减少跳出     搜索引擎     用户体验
```

## 混合渲染策略

### 动静结合

针对不同页面特性采用不同的渲染策略。

```
混合架构:
[预渲染页面]        [动态页面]        [增量渲染]
      |                |               |
  关于我们          用户面板          博客详情
  产品介绍          购物车           新闻详情
  联系方式          订单状态         实时数据
```

### 增量预渲染

只对变更的页面进行重新预渲染。

```
增量更新:
[内容变更] -> [检测变化] -> [重新预渲染] -> [更新CDN]
      |           |           |           |
  博客发布     对比版本     仅受影响页面     快速生效
```

## 关键技术点

### 数据预获取

在预渲染阶段获取页面所需数据。

```
数据注入:
[构建开始] -> [API调用] -> [数据注入] -> [渲染页面] -> [静态HTML]
      |           |           |           |           |
  触发构建     获取内容     组件props     生成HTML     包含数据
```

### 动态内容处理

处理预渲染中的动态逻辑。

```
动态内容策略:
[占位符] -> [客户端激活] -> [动态替换] -> [完全交互]
      |           |           |           |
  静态内容     加载JS       更新数据     增强体验
```

## 流行框架支持

### React 生态

```
React预渲染方案:
Next.js:     [静态生成] -> [增量静态再生] -> [混合模式]
Gatsby:      [数据层] -> [GraphQL] -> [优化构建] -> [静态输出]
React Snap:  [零配置] -> [Puppeteer] -> [预渲染] -> [SEO优化]
```

### Vue 生态

```
Vue预渲染方案:
Nuxt.js:     [静态目标] -> [generate命令] -> [全站预渲染]
VuePress:    [文档站点] -> [Markdown渲染] -> [静态生成]
@vue/cli:    [插件系统] -> [预渲染插件] -> [简单集成]
```

## 部署优化

### CDN 分发

利用全球内容分发网络加速访问。

```
CDN加速:
[用户访问] -> [边缘节点] -> [缓存命中] -> [极速响应]
      |           |           |           |
  就近访问     全球部署     静态文件     低延迟
```

### 缓存策略

配置长期缓存提升性能。

```
缓存配置:
HTML文件:    [短时间缓存] -> [内容更新及时]
静态资源:    [长期缓存] -> [哈希文件名] -> [永不失效]
              |           |           |
           版本控制     内容变化     性能最优
```

## 局限性考量

### 不适用场景

某些场景下预渲染并非最佳选择。

```
避免场景:
[实时数据] -> [用户个性化] -> [频繁更新] -> [复杂交互]
      |           |           |           |
  股票行情     用户仪表板     新闻首页     管理后台
```

### 构建时间成本

页面数量增多时构建时间显著增加。

```
构建时间增长:
页面数量      构建时间
10个         30秒
100个        5分钟  
1000个       1小时+
```

## 最佳实践

### 路由规划

合理规划需要预渲染的路由。

```
路由策略:
[关键页面] -> [优先预渲染] -> [核心内容] -> [SEO重点]
      |           |           |           |
  首页入口     重要转化     价值内容     搜索流量
```

### 性能监控

持续监控预渲染页面的实际表现。

```
监控指标:
[加载时间] -> [核心Web指标] -> [用户行为] -> [转化率]
      |           |           |           |
  性能基线     LCP/FID/CLS     点击热图     业务效果
```

## 未来演进

### 智能预渲染

基于用户行为预测的智能预渲染。

```
智能预测:
[用户分析] -> [行为模式] -> [预测访问] -> [提前渲染]
      |           |           |           |
  数据统计     路径分析     可能页面     准备内容
```

### 边缘预渲染

在 CDN 边缘节点按需预渲染。

```
边缘渲染:
[用户请求] -> [边缘节点] -> [按需渲染] -> [缓存复用]
      |           |           |           |
  首次访问     检测缺失     即时生成     后续共享
```